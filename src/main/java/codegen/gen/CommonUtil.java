package codegen.gen;

import java.io.File;
import java.sql.Types;
import java.util.Objects;

import org.apache.maven.plugin.MojoExecutionException;

import com.google.common.base.CaseFormat;

/**
 * @author: baotingyu
 * @date: 2023/6/25
 **/
public class CommonUtil {

    public static final String JAVA_DOC = "Auto generated by codegen-maven-plugin ";

    public static String mapUnderScoreToLowerCamelCase(String underScoreStr) {
        return CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.LOWER_CAMEL, underScoreStr);
    }

    public static String mapUnderScoreToUpperCamelCase(String underScoreStr) {
        return CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.UPPER_CAMEL, underScoreStr);
    }

    public static String getAbsolutePathForPkg(String baseDir, String pkgPath) throws MojoExecutionException {
        String osName = System.getProperty("os.name");
        boolean isWindows = osName.toLowerCase().contains("win");

        if (isWindows) {
            pkgPath = pkgPath.replace(".", "\\");
            baseDir = baseDir.replace("/", "\\");
            return baseDir + "\\src\\main\\java\\" + pkgPath;
        } else {
            pkgPath = pkgPath.replace('.', '/');
            return baseDir + "/src/main/java/" + pkgPath;
        }
    }

    public static String getAbsolutePathForSrcMainJava(String baseDir) {
        if (isWin()) {
            baseDir = baseDir.replace("/", "\\");
            return baseDir + "\\src\\main\\java";
        } else {
            return baseDir + "/src/main/java/";
        }
    }

    public static boolean isWin() {
        String osName = System.getProperty("os.name");
        return osName.toLowerCase().contains("win");
    }

    public static void prepareDir(String fileDir) throws MojoExecutionException {
        try {
            File file = new File(fileDir);

            if (file.exists() && file.isDirectory()) {
                File[] files = file.listFiles();
                if (files != null) {
                    for (File f : files) {
                        f.delete();
                    }
                }
            }
            file.delete();
            file.mkdirs();
        } catch (Exception e) {
            throw new MojoExecutionException("Failed to generate code: " + e.getMessage());
        }
    }

    public static String getterMethodNameFromColumnName(String columnName) {
        String s = CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.UPPER_CAMEL, columnName);
        return "get" + s;
    }

    public static String setterMethodNameFromColumnName(String columnName) {
        String s = CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.UPPER_CAMEL, columnName);
        return "set" + s;
    }

    public static Class<?> convertJDBCTypetoClass(int jdbcType) {
        Class<?> result = Object.class;
        switch (jdbcType) {
            case Types.CHAR:
            case Types.VARCHAR:
            case Types.LONGVARCHAR:
            case Types.TIME:
            case Types.TIMESTAMP:
            case Types.DATE:
                result = String.class;
                break;
            case Types.NUMERIC:
            case Types.DECIMAL:
                result = java.math.BigDecimal.class;
                break;
            case Types.BIT:
            case Types.TINYINT:
            case Types.SMALLINT:
            case Types.INTEGER:
                result = Integer.class;
                break;
            case Types.BIGINT:
                result = Long.class;
                break;
            case Types.REAL:
            case Types.FLOAT:
                result = Float.class;
                break;
            case Types.DOUBLE:
                result = Double.class;
                break;
            case Types.BINARY:
            case Types.VARBINARY:
            case Types.LONGVARBINARY:
                result = Byte[].class;
                break;
        }
        return result;
    }

}
